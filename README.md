# Smart Contracts for the Mediterraneus Protocol 

## Requirements
1. Solidity compiler
2. NPM

Clone the repository and install the dependecies. 
```sh
$ cd SC_DataMarketplace_samples
$ npm install --save-dev
```

Compile the contracts
```sh
$ npx hardhat compile
```

## Local Deployment
Smart contracts can be deployed on the hardhat local network. It is an EVM-like emulated chain.
1. Start a local node
```sh
$ npm install
$ npx hardhat node
```
2. In other shell we can run the deploy script by specifying the local hardhat network
```sh
$ npx hardhat run --network localhost scripts/deploy.js
```

## Prepare environment
1. Create a .env file and where o save the private key of your wallet.
The .env file should look like this:
```
PRIVATE_KEY='<priv_key1>'
PRIVATE_KEY_2='<priv_key2>'
```
2. In the hardhat.config.js specify the various networks to play around with different wallets
```js
  'shimmerevm-testnet': {
    url: 'https://json-rpc.evm.testnet.shimmer.network',
    chainId: 1071,
    gas: 2100000, 
    gasPrice: 8000000000,
    accounts: [process.env.PRIVATE_KEY],
  }
```

## Run the scripts
1. Deploy the contracts
```sh
$ npx hardhat run --network shimmerevm-testnet scripts/deploy.js
```
2. Run the various scripts to play with the contracts
```sh
$ npx hardhat run --network <your-network> scripts/<script.js>
```

## Verify the deployed smart contracts code
Verifying a contract means making its source code public, along with the compiler settings you used, which 
allows anyone to compile it and compare the generated bytecode with the one that is deployed on-chain.

1. Modify the hardhat config by adding the `etherscan` information as follows:
```js
    module.exports = {
    solidity: "0.8.18",
    settings: {
        ...
    },
    networks: {
        ...
    },
    etherscan: {
        apiKey: {
        'shimmerevm-testnet': 'ABCDE12345ABCDE12345ABCDE123456789' 
        },
        customChains: [
        {
            network: 'shimmerevm-testnet',
            chainId: 1071,
            urls: {
            apiURL: 'https://explorer.evm.testnet.shimmer.network/api',
            browserURL: 'https://explorer.evm.testnet.shimmer.network/'
            }
        }
        ]
    }
    };
```

2. Verify the SCs' code:
```sh
$ npx hardhat verify --network shimmerevm-testnet <contract address> "<contract constructor Arg1>" "<contract constructor Arg2>"
```

## Smart Contracts literature used for developement
1. Writing Upgradeable SCs
```
    https://docs.openzeppelin.com/upgrades-plugins/1.x/writing-upgradeable
    https://docs.openzeppelin.com/contracts/4.x/upgradeable
    
    Proxy Smart Contracts
        https://docs.openzeppelin.com/contracts/4.x/api/proxy
```

2. Support for EIP-2612 
``` 
    https://eips.ethereum.org/EIPS/eip-2612
    https://soliditydeveloper.com/erc20-permit
```