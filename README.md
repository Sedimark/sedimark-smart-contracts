# Smart Contracts for the Mediterraneus Protocol 

## Requirements
1. [Solidity compiler (hardhat)](https://hardhat.org/)
2. [npm](https://docs.npmjs.com/downloading-and-installing-node-js-and-npm) 

## Prepare environment

1. Create a `.env` file starting from `.env.example` file and update the values accordingly.
 
```conf
PRIVATE_KEY_ISSUER='<priv_key>'
```

2. In the `hardhat.config.js` specify the various networks to play around with different accounts. 

```js
  'hardhat-issuer': {
      url: 'http://127.0.0.1:8545/',
      chainId: 31337,
      gas: 2100000, 
      gasPrice: 8000000000,
      accounts: [process.env.PRIVATE_KEY_ISSUER],
    },
```



## Local Deployment
Smart contracts can be deployed on the hardhat local network. It is an EVM-like emulated chain.

1. Clone the repository and install the dependecies. 
```sh
npm install --save-dev
```

2. Compile the contracts
```sh
npx hardhat compile
```

3. Start a local node
```sh
npx hardhat node
```

4. To fund issuer and other addresses
```sh
npx hardhat --network localhost faucet <eth-address>
```

5. In other shell we can run the deploy script by specifying the local hardhat network
```sh
npx hardhat run --network hardhat-issuer scripts/deploy.js
```


## Run the scripts

1. Deploy the contracts
```sh
npx hardhat run --network shimmerevm-testnet scripts/deploy.js
```

2. Run the various scripts to play with the contracts
```sh
npx hardhat run --network <your-network> scripts/<script.js>
```

## Verify the deployed smart contracts code
Verifying a contract means making its source code public, along with the compiler settings you used, which 
allows anyone to compile it and compare the generated bytecode with the one that is deployed on-chain.

1. Modify the hardhat config by adding the `etherscan` information as follows:
```js
    module.exports = {
    solidity: "0.8.18",
    settings: {
        ...
    },
    networks: {
        ...
    },
    etherscan: {
        apiKey: {
        'shimmerevm-testnet': 'ABCDE12345ABCDE12345ABCDE123456789' 
        },
        customChains: [
        {
            network: 'shimmerevm-testnet',
            chainId: 1071,
            urls: {
            apiURL: 'https://explorer.evm.testnet.shimmer.network/api',
            browserURL: 'https://explorer.evm.testnet.shimmer.network/'
            }
        }
        ]
    }
    };
```

2. Verify the SCs' code:
```sh
npx hardhat verify --network shimmerevm-testnet <contract address> "<contract constructor Arg1>" "<contract constructor Arg2>"
```

## Smart Contracts literature used for developement
1. Writing Upgradeable SCs
```
    https://docs.openzeppelin.com/upgrades-plugins/1.x/writing-upgradeable
    https://docs.openzeppelin.com/contracts/4.x/upgradeable
    
    Proxy Smart Contracts
        https://docs.openzeppelin.com/contracts/4.x/api/proxy
```

2. Support for EIP-2612 
``` 
    https://eips.ethereum.org/EIPS/eip-2612
    https://soliditydeveloper.com/erc20-permit
```

3. Timestamp manipulation (the 15 seconds rule)
```
https://consensys.github.io/smart-contract-best-practices/development-recommendations/solidity-specific/timestamp-dependence/
```

## License

[GPL-3.0-or-later](https://spdx.org/licenses/GPL-3.0-or-later.html)
